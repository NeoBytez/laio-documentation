"use strict";(self.webpackChunklaio_documentation=self.webpackChunklaio_documentation||[]).push([[993],{4922:(e,l,t)=>{t.r(l),t.d(l,{assets:()=>c,contentTitle:()=>r,default:()=>h,frontMatter:()=>a,metadata:()=>i,toc:()=>o});var s=t(4848),n=t(8453);const a={title:"Bullet Solver",hide_table_of_contents:!1},r=void 0,i={id:"Samples/BulletSolver",title:"Bullet Solver",description:"Overview",source:"@site/docs/Samples/BulletSolver.md",sourceDirName:"Samples",slug:"/Samples/BulletSolver",permalink:"/laio-documentation/Samples/BulletSolver",draft:!1,unlisted:!1,tags:[],version:"current",frontMatter:{title:"Bullet Solver",hide_table_of_contents:!1},sidebar:"tutorialSidebar",previous:{title:"Template Editor",permalink:"/laio-documentation/LaioEditor/TemplateEditor/"},next:{title:"GPU Instancing",permalink:"/laio-documentation/Samples/GPUInstancing"}},c={},o=[{value:"Overview",id:"overview",level:2},{value:"Quick Start",id:"quick-start",level:2},{value:"Bullet Solver",id:"bullet-solver",level:2},{value:"Creating your own solver",id:"creating-your-own-solver",level:3},{value:"Properties",id:"properties",level:4},{value:"Methods",id:"methods",level:4},{value:"Bullet",id:"bullet",level:2},{value:"Public properties",id:"public-properties",level:4},{value:"Public methods",id:"public-methods",level:4},{value:"Damageable",id:"damageable",level:2},{value:"Surfaces",id:"surfaces",level:2},{value:"SimpleSurface",id:"simplesurface",level:3}];function d(e){const l={admonition:"admonition",code:"code",h2:"h2",h3:"h3",h4:"h4",li:"li",p:"p",pre:"pre",ul:"ul",...(0,n.R)(),...e.components};return(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)(l.h2,{id:"overview",children:"Overview"}),"\n",(0,s.jsx)(l.p,{children:"The Bullet Solver provides a simple solution for managing bullets. It handles bullet velocity, collision detection, surfaces, deflections, and tumbling. The system's base classes offer a solid foundation for creating custom bullet management systems. Additionally, it\u2019s easily expandable to include features like networking, decals, and more."}),"\n",(0,s.jsxs)(l.p,{children:["The core class is ",(0,s.jsx)(l.code,{children:"BulletSolver"}),", which manages all ",(0,s.jsx)(l.code,{children:"Bullet"})," instances. When a new ",(0,s.jsx)(l.code,{children:"Bullet"})," is spawned, it is registered with the ",(0,s.jsx)(l.code,{children:"BulletSolver"}),". Upon destruction, it is removed from the system. Each frame, the ",(0,s.jsx)(l.code,{children:"BulletSolver"})," iterates through all bullets and calculates their displacement. The ",(0,s.jsx)(l.code,{children:"CollisionCheck(Vector3 origin, Vector3 displacement)"})," method is then invoked in each bullet, which performs a raycast to check for collisions and interactions with Surface objects."]}),"\n",(0,s.jsxs)(l.ul,{children:["\n",(0,s.jsx)(l.li,{children:"Standard collisions result in the bullet being destroyed."}),"\n",(0,s.jsx)(l.li,{children:"Surfaces offer more nuanced behavior, such as deflection, tumbling, or stopping the bullet entirely."}),"\n"]}),"\n",(0,s.jsxs)(l.p,{children:["Bullets use the ",(0,s.jsx)(l.code,{children:"IDamageable"})," interface to deal damage."]}),"\n",(0,s.jsx)(l.h2,{id:"quick-start",children:"Quick Start"}),"\n",(0,s.jsxs)(l.p,{children:["Drag and drop both the ",(0,s.jsx)(l.code,{children:"BulletSolver"})," and ",(0,s.jsx)(l.code,{children:"SamplePlayer FPS Variant"})," prefabs found in ",(0,s.jsx)(l.code,{children:"Laio/BulletSolver/Prefabs"})," into the scene."]}),"\n",(0,s.jsxs)(l.p,{children:["If using your own player script, when instantiating a bullet, call ",(0,s.jsx)(l.code,{children:"bullet.Setup(this)"}),", where ",(0,s.jsx)(l.code,{children:"this"})," is the instigator."]}),"\n",(0,s.jsx)(l.pre,{children:(0,s.jsx)(l.code,{className:"language-csharp",children:" public void Shoot()\r\n{\r\n    Bullet newBullet = Instantiate(bulletPrefab, transform).GetComponent<Bullet>();\r\n    newBullet.transform.position = transform.position;\r\n    newBullet.Setup(this);\r\n}\n"})}),"\n",(0,s.jsxs)(l.p,{children:["For damage handling, use the ",(0,s.jsx)(l.code,{children:"IDamageable"})," interface, which provides two methods for taking damage:"]}),"\n",(0,s.jsx)(l.pre,{children:(0,s.jsx)(l.code,{className:"language-csharp",children:"public abstract void TakeDamage(float damage);\n"})}),"\n",(0,s.jsx)(l.pre,{children:(0,s.jsx)(l.code,{className:"language-csharp",children:"public abstract void TakeDamage(float damage, object instigator);\n"})}),"\n",(0,s.jsxs)(l.p,{children:["To set up surfaces, attach the ",(0,s.jsx)(l.code,{children:"SimpleSurface"})," script to any object you want bullets to interact with. Select or create a new surface data to apply to the object. To create a new surface data asset, right-click in the project window and select ",(0,s.jsx)(l.code,{children:"Create > Bullets > SimpleSurface"}),"."]}),"\n",(0,s.jsx)(l.h2,{id:"bullet-solver",children:"Bullet Solver"}),"\n",(0,s.jsxs)(l.p,{children:["The ",(0,s.jsx)(l.code,{children:"BulletSolver"})," is responsible for managing all bullets. It uses a ",(0,s.jsx)(l.code,{children:"HashSet<T>"})," where T is of type ",(0,s.jsx)(l.code,{children:"Bullet"}),", and iterates over this set each frame to call Solve() on each bullet."]}),"\n",(0,s.jsxs)(l.p,{children:["To avoid modifying the ",(0,s.jsx)(l.code,{children:"HashSet<T>"})," during iteration, a secondary ",(0,s.jsx)(l.code,{children:"HashSet<T>"})," is used to store bullets that need to be removed. Removal occurs at the start of the next frame."]}),"\n",(0,s.jsxs)(l.p,{children:["The solver uses ",(0,s.jsx)(l.code,{children:"System.Stopwatch"})," to track the time it takes to solve all bullets. This feature is enabled by default, and can be accessed from its ",(0,s.jsx)(l.code,{children:"TimeToSolveMS"})," property."]}),"\n",(0,s.jsx)(l.h3,{id:"creating-your-own-solver",children:"Creating your own solver"}),"\n",(0,s.jsxs)(l.p,{children:["Creating a new solver is simple. Create a new script and inherit from ",(0,s.jsx)(l.code,{children:"BulletSolver"}),", using your custom bullet class as the type parameter. Then, override the ",(0,s.jsx)(l.code,{children:"Solve()"})," method to add your custom logic."]}),"\n",(0,s.jsx)(l.pre,{children:(0,s.jsx)(l.code,{className:"language-csharp",children:"public class MySolver : BulletSolver<MyBullet>\r\n{\r\n    public override void Solve(MyBullet bullet)\r\n    {\r\n        // Custom solve logic\r\n    }\r\n}\n"})}),"\n",(0,s.jsx)(l.h4,{id:"properties",children:"Properties"}),"\n",(0,s.jsx)(l.pre,{children:(0,s.jsx)(l.code,{className:"language-csharp",children:"protected HashSet<TBullet> BulletHashSet { get; private set; }\n"})}),"\n",(0,s.jsx)(l.pre,{children:(0,s.jsx)(l.code,{className:"language-csharp",children:"protected float BulletCount { get; }\n"})}),"\n",(0,s.jsx)(l.pre,{children:(0,s.jsx)(l.code,{className:"language-csharp",children:"protected float TimeToSolveMS { get; }\n"})}),"\n",(0,s.jsx)(l.h4,{id:"methods",children:"Methods"}),"\n",(0,s.jsx)(l.pre,{children:(0,s.jsx)(l.code,{className:"language-csharp",children:"public void RegisterBullet(TBullet bullet)\n"})}),"\n",(0,s.jsx)(l.pre,{children:(0,s.jsx)(l.code,{className:"language-csharp",children:"public void DisposeBullet(TBullet bullet)\n"})}),"\n",(0,s.jsx)(l.h2,{id:"bullet",children:"Bullet"}),"\n",(0,s.jsxs)(l.p,{children:["The ",(0,s.jsx)(l.code,{children:"Bullet"})," class is the base class for all bullets and their interactions with the ",(0,s.jsx)(l.code,{children:"BulletSolver"}),"."]}),"\n",(0,s.jsxs)(l.p,{children:["The ",(0,s.jsx)(l.code,{children:"Setup()"})," method registers the bullet, sets the ",(0,s.jsx)(l.code,{children:"Instigator"}),", and records the start time."]}),"\n",(0,s.jsx)(l.admonition,{type:"note",children:(0,s.jsxs)(l.p,{children:["If the ",(0,s.jsx)(l.code,{children:"Instigator"})," is not required, it\u2019s recommended to call ",(0,s.jsx)(l.code,{children:"Setup()"})," in ",(0,s.jsx)(l.code,{children:"Start()"})," on the bullet."]})}),"\n",(0,s.jsxs)(l.p,{children:["The ",(0,s.jsx)(l.code,{children:"CollisionCheck()"})," method is responsible for detecting collisions. It receives the bullet's origin and displacement for the current frame and performs a raycast with those values."]}),"\n",(0,s.jsx)(l.pre,{children:(0,s.jsx)(l.code,{className:"language-csharp",children:"if (Physics.Raycast(new Ray(origin, displacement), out RaycastHit hit, displacement.magnitude, layerMask.value))\r\n{\r\n    //Collision check\r\n}\n"})}),"\n",(0,s.jsx)(l.h4,{id:"public-properties",children:"Public properties"}),"\n",(0,s.jsx)(l.pre,{children:(0,s.jsx)(l.code,{className:"language-csharp",children:"public bool IsSetup { get; private set; }\n"})}),"\n",(0,s.jsx)(l.pre,{children:(0,s.jsx)(l.code,{className:"language-csharp",children:"public float Lifetime { get; private set; }\n"})}),"\n",(0,s.jsx)(l.pre,{children:(0,s.jsx)(l.code,{className:"language-csharp",children:"public object Instigator  { get; private set; }\n"})}),"\n",(0,s.jsx)(l.h4,{id:"public-methods",children:"Public methods"}),"\n",(0,s.jsx)(l.pre,{children:(0,s.jsx)(l.code,{className:"language-csharp",children:"public virtual void Setup(object instigator)\n"})}),"\n",(0,s.jsx)(l.pre,{children:(0,s.jsx)(l.code,{className:"language-csharp",children:"public abstract float GetDamage()\n"})}),"\n",(0,s.jsx)(l.pre,{children:(0,s.jsx)(l.code,{className:"language-csharp",children:"public abstract void CollisionCheck(Vector3 origin, Vector3 direction)\n"})}),"\n",(0,s.jsx)(l.pre,{children:(0,s.jsx)(l.code,{className:"language-csharp",children:"public abstract void Dispose()\n"})}),"\n",(0,s.jsx)(l.pre,{children:(0,s.jsx)(l.code,{className:"language-csharp",children:"public abstract void Register()\n"})}),"\n",(0,s.jsx)(l.h2,{id:"damageable",children:"Damageable"}),"\n",(0,s.jsxs)(l.p,{children:["The ",(0,s.jsx)(l.code,{children:"IDamageable"})," interface allows bullets to apply damage to game objects. It provides two method signatures:"]}),"\n",(0,s.jsx)(l.pre,{children:(0,s.jsx)(l.code,{className:"language-csharp",children:"public abstract void TakeDamage(float damage)\n"})}),"\n",(0,s.jsx)(l.pre,{children:(0,s.jsx)(l.code,{className:"language-csharp",children:"public abstract void TakeDamage(float damage, object Instigator)\n"})}),"\n",(0,s.jsxs)(l.p,{children:["If a bullet has an ",(0,s.jsx)(l.code,{children:"Instigator"}),", the method with the ",(0,s.jsx)(l.code,{children:"Instigator"})," argument will be called. Otherwise, the single-parameter method will be used."]}),"\n",(0,s.jsx)(l.h2,{id:"surfaces",children:"Surfaces"}),"\n",(0,s.jsxs)(l.p,{children:["The ",(0,s.jsx)(l.code,{children:"Surface<T>"})," abstract class defines the ",(0,s.jsx)(l.code,{children:"OnImpact()"})," method, which is called when a bullet hits the surface."]}),"\n",(0,s.jsx)(l.pre,{children:(0,s.jsx)(l.code,{className:"language-csharp",children:'/// <summary>\r\n/// Impact check for bullet hitting surface\r\n/// </summary>\r\n/// <param name="bullet">Bullet data passed in to modify based on surface params</param>\r\n/// <param name="hit">Hit from raycast</param>\r\n/// <returns>Should the bullet be stopped on impact?</returns>\r\npublic abstract bool OnImpact(T bullet, RaycastHit hit);\n'})}),"\n",(0,s.jsx)(l.admonition,{type:"note",children:(0,s.jsx)(l.p,{children:"OnImpact() returns a boolean indicating whether the bullet should be stopped."})}),"\n",(0,s.jsx)(l.h3,{id:"simplesurface",children:"SimpleSurface"}),"\n",(0,s.jsx)(l.p,{children:"The SimpleSurface class includes percentage chances for various bullet behaviors:"}),"\n",(0,s.jsxs)(l.ul,{children:["\n",(0,s.jsxs)(l.li,{children:[(0,s.jsx)(l.code,{children:"StopChance"}),": Chance that the bullet will stop on impact."]}),"\n",(0,s.jsxs)(l.li,{children:[(0,s.jsx)(l.code,{children:"DeflectionChance"}),": Chance that the bullet will be deflected."]}),"\n",(0,s.jsxs)(l.li,{children:[(0,s.jsx)(l.code,{children:"TumbleChance"}),": Chance that the bullet will tumble after impact."]}),"\n"]}),"\n",(0,s.jsxs)(l.p,{children:["If tumbling occurs, the bullet's forward direction will be modified based on the ",(0,s.jsx)(l.code,{children:"TumbleStrength"}),". Additionally, the surface's ",(0,s.jsx)(l.code,{children:"Mass"})," property acts as a flat reduction to the bullet's speed."]})]})}function h(e={}){const{wrapper:l}={...(0,n.R)(),...e.components};return l?(0,s.jsx)(l,{...e,children:(0,s.jsx)(d,{...e})}):d(e)}},8453:(e,l,t)=>{t.d(l,{R:()=>r,x:()=>i});var s=t(6540);const n={},a=s.createContext(n);function r(e){const l=s.useContext(a);return s.useMemo((function(){return"function"==typeof e?e(l):{...l,...e}}),[l,e])}function i(e){let l;return l=e.disableParentContext?"function"==typeof e.components?e.components(n):e.components||n:r(e.components),s.createElement(a.Provider,{value:l},e.children)}}}]);